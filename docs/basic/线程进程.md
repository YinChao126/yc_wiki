# 进程与线程

作者：尹超

日期：2019-12-2

## 进程与线程的比较

1. 进程之间不能共享内存，但线程之间共享内存非常容易。
2. 操作系统在创建进程时，需要为该进程重新分配系统资源，但创建线程的代价则小得多。因此，使用多线程来实现多任务并发执行比使用多进程的效率高。
3. [Python](http://c.biancheng.net/python/) 语言内置了多线程功能支持，而不是单纯地作为底层操作系统的调度方式，从而简化了 Python 的多线程编程。

**线程安全**

当多个线程访问某个方法时，不管你通过怎样的调用方式、或者说这些线程如何交替地执行，我们在主程序中不需要去做任何的同步，这个类的结果行为都是我们设想的正确行为，那么我们就可以说这个类是线程安全的。 

简单讲，如果<u>一个资源没有状态保存机制，则就是线程安全的</u>，不论什么方式并行调用都一样。如果一个资源有状态（依赖于全局变量，或者累计功能），那么并行调用就会涉及资源竞争，从而导致线程不安全。

**如何确保线程安全？**

**1、synchronized（自动）**

synchronized关键字，就是用来控制线程同步的，保证我们的线程在多线程环境下，不被多个线程同时执行，确保我们数据的完整性，使用方法一般是加在方法上。

**2、Lock（手动）**

手动对资源进行锁定与解锁。资源锁定后，其他线程如果要用该资源，会被阻塞，直到该资源被释放。

## 并发编程三要素

原子性

一个操作，要么全部被执行，要么都不执行

可见性

一个线程修改了变量后，其他线程立马可见

有序性

程序的执行顺序按照代码的先后顺序来执行



## 线程的优势

发挥CPU多核的优势

防止阻塞



## 线程池

提前创建若干线程，如果有任务处理需要，则线程池里的线程就会处理，处理完之后线程并不会被销毁，而是等待下一个任务的到来。【应对频繁创建核销毁线程的场景，用以提升整体性能】

其优点在于

1）重用存在的线程，减少对象创建销毁的开销。

2）可有效的控制最大并发线程数，提高系统资源的使用率，同时避免过多资源竞争，避免堵塞。

3）提供定时执行、定期执行、单线程、并发数控制等功能。



多线程上下文切换

多线程的上下文切换是指CPU控制权由一个已经正在运行的线程切换到另外一个就绪并等待获取CPU执行权的线程的过程。

## 各种锁机制

### 自旋

很多synchronized里面的代码只是一些很简单的代码，执行时间非常快，此时等待的线程都加锁可能是一种不太值得的操作，因为线程阻塞涉及到用户态和内核态切换的问题。既然synchronized里面的代码执行得非常快，不妨让等待锁的线程不要被阻塞，而是在synchronized的边界做忙循环，这就是自旋。

### 互斥量

互斥量用于线程的互斥，互斥量只能为0/1，实现单个资源的互斥访问，即锁定机制。

### 信号量

信号量用于线程的同步，信号量可以为非负整数，实现多个资源的互斥访问。

## 线程应用示例





## 参考资料

[进程与线程基础讲解](http://c.biancheng.net/view/2602.html)

[教你瞬间明白线程和线程安全](https://blog.csdn.net/csdnnews/article/details/82321777)

[自旋锁的解释](https://blog.csdn.net/qq_42549792/article/details/102564358)

[spin_lock 自旋锁 和 mutex_lock 互斥锁的区别](https://blog.csdn.net/zixiao217/article/details/77063332)